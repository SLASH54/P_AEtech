<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle de Nota | AEtech</title>
    <link rel="stylesheet" href="cuentas.css"> <style>
        body { background: #f2f2f7; display: flex; justify-content: center; padding: 20px; }
        .public-card { background: white; width: 100%; max-width: 500px; border-radius: 30px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .badge-status { background: #34c759; color: white; padding: 5px 12px; border-radius: 10px; font-size: 12px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="public-card">
        <header style="text-align: center; margin-bottom: 20px; background: transparent;">
            <img src="img/watermark.png" width="80">
            <h2 id="pub-nota-num" style="color: #1c1c1e; margin-top: 10px;">Cargando...</h2>
            <span class="badge-status">Nota Oficial</span>
        </header>

        <div id="pub-detalle">
            <p><strong>Cliente:</strong> <span id="pub-cliente"></span></p>
            <hr style="opacity: 0.1;">
            <div id="pub-lista-materiales"></div>
            
            <div class="lev-totales-container" style="background: rgba(0,0,0,0.03); margin-top: 20px;">
                <div class="lev-total-field"><label>Total:</label> <span id="pub-total" style="font-weight: bold;"></span></div>
                <div class="lev-total-field"><label style="color: #007aff;">Anticipo:</label> <span id="pub-anticipo"></span></div>
                <div class="lev-total-field"><label style="color: #ff3b30;">Saldo:</label> <span id="pub-saldo" style="font-weight: 800; color: #ff3b30;"></span></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://p-aetech.onrender.com/api';
        
        async function cargarNotaPublica() {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            
            if(!id) return;

            try {
                // Apuntamos a la nueva ruta pública que creamos
                const res = await fetch(`${API_BASE_URL}/cuentas/publica/${id}`); 
                
                if (!res.ok) {
                    document.getElementById('pub-detalle').innerHTML = "<h1>Nota no disponible</h1>";
                    return;
                }

                const c = await res.json();

                // Llenas los campos como ya lo tenías...
                document.getElementById('pub-nota-num').innerText = c.numeroNota;
                document.getElementById('pub-cliente').innerText = c.clienteNombre;
                // ... etc
            } catch (e) {
                console.error(e);
            }
        }
        cargarNotaPublica();
    </script>
</body>
</html>