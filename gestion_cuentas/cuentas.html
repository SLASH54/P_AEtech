<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GestiÃ³n de Cuentas</title>
    <link rel="stylesheet" href="cuentas.css">
    <link rel="icon" href="img/logoAEtech.png">
</head>
<body>

    <div id="loader" class="loader-overlay" style="display: none;">
        <div class="loader-container">
            <div class="spinner"></div>
            <p>Procesando, por favor espera...</p>
        </div>
    </div>

    <div class="container">
        <header class="ios-header">
            <div class="header-side">
                <button onclick="window.location.href='../sistema.html'" class="btn-back-ios-header">
                    ðŸ”™
                </button>
            </div>

            <div class="header-center">
                <img src="img/watermark.png" width="80px" height="80px">
            </div>

            <div class="header-side"></div>
        </header>

        <div id="listaCuentas" class="main-content show">
            <div class="tareas-container">
                <h2 class="section-title">Organizador de Cuentas</h2>

         <div class="lev-header-actions" style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px; flex-wrap: wrap;">
    <button id="btnNuevaCuenta" onclick="openNuevaCuenta()" class="btn btn-primary" style="margin-bottom: 0;">
        + Nueva Cuenta
    </button>

    <div style="display: flex; gap: 5px; align-items: center;">
        <select id="filtroCliente" onchange="filtrarNotasPorCliente()" class="glass-select-ios">
            <option value="">ðŸ‘¤ Todos los Clientes</option>
        </select>
        
        <button onclick="limpiarFiltroCliente()" class="btn-clear-ios" title="Limpiar Filtro">
            âœ•
        </button>

        
    <button onclick="window.location.href='../sistema.html'" class="btn-back-ios" title="Regresar al MenÃº">
            ðŸ”™
        </button>
    </div>
</div>

                <div class="table-responsive" style="margin-top: 15px;">
                    <table class="tabla">
                        <thead>
                            <tr>
                                <th>Nota</th>
                                <th>Cliente</th>
                                <th>Estatus</th>
                                <th>Monto</th>
                                <th>Fecha</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaCuentas"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="modalNuevaCuenta" class="modalGlass">
            <div class="modalGlass-content">

                <h2 id="labelNumeroNota" class="modalGlass-title">Nota #</h2>
                <span class="modalGlass-close" onclick="cerrarNuevaCuentaModal()">âœ–</span>
                
                <div class="lev-form-grid">
                    <div class="lev-field">
                        <label>Cliente</label>
                        <select id="lev-clienteSelect"></select>
                        
                    </div>

                    <div class="lev-field">
                        <label>Fecha y Hora</label>
                        <input id="lev-fechaHora" type="datetime-local">
                    </div>
                </div>

                <hr>

                <h4>Productos:</h4>
                <div class="product-selection-container">
                    <div class="lev-product-row">
                        <select id="levInsumo" onchange="levMostrarCampoExtra()" class="ios-select">
                            <option value="" disabled selected>Seleccione un insumo</option>
                            <optgroup label="Cable">
                                <option value="Cable">Cable</option>
                            </optgroup>
                            <optgroup label="Transceptor">
                                <option value="Transceptor">Transceptor</option>
                            </optgroup>
                            <optgroup label="Conectores">
                                <option value="Conector de corriente">Conector de corriente</option>
                            </optgroup>
                            <optgroup label="Fuente de poder 12V">
                                <option value="12vdc 1A">12vdc 1A</option>
                                <option value="12vdc 1.5A">12vdc 1.5A</option>
                                <option value="12vdc 2A">12vdc 2A</option>
                                <option value="12vdc 4.1A">12vdc 4.1A</option>
                                <option value="12vdc 5A">12vdc 5A</option>
                            </optgroup>
                            <optgroup label="Fuente centralizada">
                                <option value="Fuente de poder centralizada">Fuente de poder centralizada</option>
                            </optgroup>
                            <optgroup label="Cajas">
                                <option value="Caja estanca">Caja estanca</option>
                                <option value="Caja plÃ¡stica 180x125x57">Caja plÃ¡stica 180x125x57</option>
                                <option value="Caja plÃ¡stica 190x290x140">Caja plÃ¡stica 190x290x140</option>
                            </optgroup>
                            <optgroup label="Otro">
                                <option value="Otro">Otro (especificar)</option>
                            </optgroup>
                        </select>

                        <div class="currency-input" style="width: 100px;">
                            <span>$</span>
                            <input type="number" id="levCosto" placeholder="0.00" class="ios-input-small" step="0.01">
                        </div>

                        <label for="levInputFoto" class="btn-ios-icon" title="Agregar miniatura">
                            ðŸ“¸
                            <input type="file" id="levInputFoto" accept="image/*" style="display:none;">
                        </label>

                        <button id="levBtnAgregarMaterial" class="btn-ios-add">+ Agregar</button>

                        <input type="text" id="levInsumoExtra" placeholder="Especificar Producto..." 
                           style="display:none; width: 100%; margin-top: 8px; padding: 8px; border-radius: 10px; border: 1px solid #ccc;">
                    </div>
                    
                    
                </div>

                <div id="previsualizacionFoto" class="mini-preview"></div>
                <ul id="levListaMateriales" class="ios-list"></ul>

                <div class="lev-footer-container">
                    <div class="lev-totales-column">

                        <div class="lev-total-field iva-row" style="display: flex; align-items: center; margin-bottom: 10px;">
    <label class="ios-switch">
        <input type="checkbox" id="chkFactura" onchange="toggleFactura()">
        <span class="slider"></span>
    </label>
    <span style="margin-left: 10px; font-weight: bold; color: white;">Factura</span>
    
    <div id="facturaInputContainer" style="display: none; margin-left: auto;">
        <input type="text" id="levFolioFactura" placeholder="Folio/Serie" 
               style="width: 100px; padding: 5px; border-radius: 8px; border: none; font-size: 12px;">
    </div>
</div>

                        
                        <div class="lev-total-field iva-row">
                            <label class="ios-switch">
                                <input type="checkbox" id="chkIva" onchange="toggleIva()">
                                <span class="slider"></span>
                            </label>
                            <span class="iva-label">IVA</span>
                            <div id="ivaInputContainer" class="currency-input" style="width: 70px; display: none; margin-left: auto;">
                                <input type="number" id="levIvaPorcentaje" value="16" min="0" oninput="calcularSaldo()">
                                <span>%</span>
                            </div>
                        </div>

                        <div class="lev-total-field">
                            <label>Subtotal:</label>
                            <div class="currency-input">
                                <span>$</span>
                                <input type="number" id="levSubtotal" placeholder="0.00" step="0.01" readonly="">
                            </div>
                        </div>

                        <div class="lev-total-field">
                            <label>Total:</label>
                            <div class="currency-input">
                                <span>$</span>
                                <input type="number" id="levTotal" placeholder="0.00" step="0.01" readonly>
                            </div>
                        </div>

                        <div class="lev-total-field">
                            <label>Anticipo:</label>
                            <div class="currency-input">
                                <span>$</span>
                                <input type="number" id="levAnticipo" placeholder="0.00" step="0.01" oninput="calcularSaldo()">
                            </div>
                        </div>

                        <div class="lev-total-field highlight-liquidar">
                            <label>Por liquidar:</label>
                            <div class="currency-input">
                                <span>$</span>
                                <input type="number" id="levPorLiquidar" placeholder="0.00" readonly>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lev-button-center">
                    <button id="btnGuardarCuenta" onclick="guardarCuentaFinal()" class="glass-btn-ios">
                        <div class="shine"></div> 
                        <span class="glass-text">Guardar Cuenta</span>
                    </button>
                </div>

            </div>
        </div>
    </div>

    <div id="modalDetalleCuenta" class="modalGlass" style="display: none;">
    <div class="modalGlass-content detalle-container" style="background: rgba(255, 255, 255, 0.95) !important; color: black !important; border-radius: 20px; padding: 20px; max-width: 500px;">
        <span class="modalGlass-close" onclick="cerrarDetalleModal()" style="color: black; cursor: pointer; float: right; font-size: 20px;">&times;</span>
        
        <h2 id="detNumeroNota" style="color: black; text-align: center; margin-top: 10px;">Nota #</h2>
        <div id="detBadges" style="display: flex; justify-content: center; gap: 10px; margin-bottom: 10px;"></div>

        <div id="detBadges" style="display: flex; justify-content: center; gap: 10px; margin-bottom: 10px;"></div>

<div id="detFechaPagoCont" style="display: none; text-align: center; margin-bottom: 15px; font-size: 0.85rem; color: #666; background: #f0f0f5; padding: 5px; border-radius: 10px;">
    <span id="detFechaPagoTexto"></span>
</div>
        
        <p id="detCliente" style="color: black !important; text-align: center; font-weight: bold; font-size: 1.2rem; margin-bottom: 20px;"></p>

        <div class="table-responsive">
            <table style="width: 100%; border-collapse: collapse; color: black !important;">
                <thead>
                    <tr style="border-bottom: 2px solid #ddd;">
                        <th style="text-align: left; padding: 8px;">Imagen</th>
                        <th style="text-align: left; padding: 8px;">Producto</th>
                        <th style="text-align: center; padding: 8px;">Cant.</th>
                        <th style="text-align: right; padding: 8px;">Precio</th>
                    </tr>
                </thead>
                <tbody id="detListaProductos">
                    </tbody>
            </table>
        </div>

        <div id="infoFacturaExtra" style="display:none; background: rgba(0,0,0,0.05); padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 5px solid #007aff; color: black !important;">
            </div>

        <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
            <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 5px 0;">
                <label style="color: black; font-weight: bold;">Subtotal:</label>
                <div style="color: black; font-weight: bold;">$ <input type="text" id="detSubtotal" readonly="" style="border: none; background: transparent; color: black; font-weight: bold; width: 80px; text-align: right;"></div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 5px 0;">
                <label style="color: black; font-weight: bold;">Total:</label>
                <div style="color: black; font-weight: bold;">$ <input type="text" id="detTotal" readonly style="border: none; background: transparent; color: black; font-weight: bold; width: 80px; text-align: right;"></div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 5px 0;">
                <label style="color: black; font-weight: bold;">Anticipo:</label>
                <div style="color: black; font-weight: bold;">$ <input type="text" id="detAnticipo" readonly style="border: none; background: transparent; color: black; font-weight: bold; width: 80px; text-align: right;"></div>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.03); padding: 10px; border-radius: 8px;">
                <label style="color: black; font-weight: 800;">Por Liquidar:</label>
                <div style="font-weight: 800;">$ <input type="text" id="detSaldo" readonly style="border: none; background: transparent; font-weight: 800; width: 80px; text-align: right;"></div>
            </div>
        </div>
    </div>
</div>



<div id="modalEditarCuenta" class="modalGlass" style="display: none;">
    <div class="modalGlass-content" style="max-width: 800px;">
        <span class="modalGlass-close" onclick="cerrarModalEditar()">Ã—</span>
        <h2 class="modalGlass-title">Editar Nota de Servicio</h2>
        
      <div style="text-align: center; margin-bottom: 15px; display: flex; justify-content: center; gap: 10px; align-items: center;">
    <span id="labelNumeroNotaEdit" style="background: #ff9f0a; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold;"></span>
    <span id="editEstatusBadge" class="badge-status-tabla" style="font-size: 12px; padding: 5px 12px;">PENDIENTE</span>
</div>

        <form id="levFormEditarCuenta">
            <div class="lev-grid-container">
                <div class="lev-input-group">
                    <label>Cliente:</label>
                    <select id="edit-clienteSelect" class="lev-select-custom"></select>
                </div>
                
            </div>

            <div class="lev-add-material-box">
                <h4>Productos:</h4>
                <div class="product-selection-container">
                    <div class="lev-product-row" style="display: grid; grid-template-columns: 2fr 1fr 80px auto auto; gap: 10px;">
                        <div style="display: flex; flex-direction: column;">
                            <select id="edit-levInsumo" onchange="levMostrarCampoExtraEdit()" class="ios-select">
                                <option value="" disabled selected>Seleccione un insumo</option>
                                <optgroup label="Cable">
                                    <option value="Cable">Cable</option>
                                </optgroup>
                                <optgroup label="Transceptor">
                                    <option value="Transceptor">Transceptor</option>
                                </optgroup>
                                <optgroup label="Conectores">
                                    <option value="Conector de corriente">Conector de corriente</option>
                                </optgroup>
                                <optgroup label="Fuente de poder 12V">
                                    <option value="12vdc 1A">12vdc 1A</option>
                                    <option value="12vdc 1.5A">12vdc 1.5A</option>
                                    <option value="12vdc 2A">12vdc 2A</option>
                                    <option value="12vdc 4.1A">12vdc 4.1A</option>
                                    <option value="12vdc 5A">12vdc 5A</option>
                                </optgroup>
                                <optgroup label="Fuente centralizada">
                                    <option value="Fuente de poder centralizada">Fuente de poder centralizada</option>
                                </optgroup>
                                <optgroup label="Cajas">
                                    <option value="Caja estanca">Caja estanca</option>
                                    <option value="Caja plÃ¡stica 180x125x57">Caja plÃ¡stica 180x125x57</option>
                                    <option value="Caja plÃ¡stica 190x290x140">Caja plÃ¡stica 190x290x140</option>
                                </optgroup>
                                <optgroup label="Otro">
                                    <option value="Otro">Otro (especificar)</option>
                                </optgroup>
                            </select>
                            <input type="text" id="edit-levInsumoExtra" placeholder="Â¿QuÃ© producto es?" style="display:none; margin-top:5px;" class="ios-input">
                        </div>

                        <input type="number" id="edit-prodCosto" placeholder="Precio">
                        <input type="number" id="edit-prodCant" value="1">
                        
                        <input type="file" id="edit-prodFoto" style="display:none;" onchange="procesarFotoEdit(this)">
                        <button type="button" onclick="document.getElementById('edit-prodFoto').click()" class="btn-foto">ðŸ“·</button>
                        <button type="button" onclick="agregarMaterialEdit()" class="btn-add">+</button>
                    </div>
                </div>
                <div id="previewFotoEdit" style="margin-top: 10px; display: none; text-align: center;">
                    <img id="imgPreviewEdit" src="" style="width: 60px; height: 60px; border-radius: 10px; object-fit: cover; border: 2px solid #ff9f0a;">
                </div>
            </div>

            <div class="table-responsive">
                <table id="tablaMaterialesEdit" class="tablaEdit">
                    <thead>
                        <tr>
                            <th>Imagen</th>
                            <th>Producto</th>
                            <th>Cant.</th>
                            <th>Precio</th>
                            <th>Eliminar</th>
                        </tr>
                    </thead>
                    <tbody style="color: black !important;"></tbody>
                </table>
            </div>

            <div class="lev-tax-section" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; margin-top: 15px;">
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <div class="lev-checkbox-group">
                        <label style="color: black;"><input type="checkbox" id="chkIvaEdit" onchange="calcularSaldoEdit()"> Â¿Lleva IVA?</label>
                        <input type="number" id="levIvaPorcentajeEdit" value="16" style="width: 50px; margin-left: 5px;" oninput="calcularSaldoEdit()"> %
                    </div>
                    <div class="lev-checkbox-group">
                        <label style="color: black;"><input type="checkbox" id="chkFacturaEdit" onchange="toggleFacturaEdit()"> Â¿Requiere Factura?</label>
                        <input type="text" id="levFolioFacturaEdit" placeholder="Folio Factura" style="display: none; margin-left: 10px;">
                    </div>
                </div>
            </div>

         <div class="lev-totales-container" style="display: flex; flex-direction: column; gap: 10px; background: #f9f9f9; padding: 15px; border-radius: 10px;">
    
    <div class="lev-total-field" style="display: flex; justify-content: space-between; align-items: center;">
        <label style="font-weight: bold; color: black;">Subtotal:</label>
        <input type="text" id="levSubtotalEdit" readonly="" style="border: none; background: transparent; text-align: right; font-weight: bold; width: 100px;">
    </div>

    <div class="lev-total-field" style="display: flex; justify-content: space-between; align-items: center;">
        <label style="font-weight: bold; color: black;">Total:</label>
        <input type="text" id="levTotalEdit" readonly style="border: none; background: transparent; text-align: right; font-weight: bold; width: 100px;">
    </div>

    <div class="lev-total-field" style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd; padding: 5px 0;">
        <label style="font-weight: bold; color: #28a745;">Anticipo:</label>
        <input type="number" id="levAnticipoEdit" oninput="calcularSaldoEdit()" style="width: 100px; text-align: right; border: 1px solid #ccc; border-radius: 5px; padding: 3px;">
    </div>

    <div class="lev-total-field" style="display: flex; justify-content: space-between; align-items: center;">
        <label style="font-weight: bold; color: #ff3b30;">Saldo (Por liquidar):</label>
        <input type="text" id="levSaldoEdit" readonly style="border: none; background: transparent; text-align: right; font-weight: bold; color: #ff3b30; width: 100px;">
    </div>

</div>

      <div class="lev-button-center">
    <button type="button" onclick="actualizarCuentaFinal()" class="glass-btn-ios">
        <span class="glass-text">Actualizar Cambios</span>
    </button>
</div>
        </form>
    </div>
</div>

    <script src="scriptCuentas.js"></script>
</body>
</html>