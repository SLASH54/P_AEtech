// src/config/database.js
const { Sequelize, DataTypes } = require('sequelize');
require('dotenv').config();



// ... (aseg√∫rate de que esta l√≥gica est√© presente)
const isProduction = process.env.NODE_ENV === 'production' || process.env.DATABASE_URL;

const sequelize = new Sequelize(isProduction ? process.env.DATABASE_URL : {
  database: process.env.DB_NAME,
    username: process.env.DB_USER,
    password: process.env.DB_PASSWORD,
    host: process.env.DB_HOST,
    dialect: 'postgres',
    // ... (configuraci√≥n local)
}, isProduction ? {
    // ‚¨á ESTA ES LA CONFIGURACI√ìN CR√çTICA PARA RENDER ‚¨á
    dialectOptions: {
        ssl: {
            require: true, 
            rejectUnauthorized: false // Permite la conexi√≥n aunque no haya certificado ra√≠z
        }
    }
}¬†:¬†{});¬†



    // Configuraci√≥n espec√≠fica para producci√≥n (SSL) si usas una URL de Render/otro
    //dialectOptions: isProduction ? {
    //    ssl: {
    //       require: true, 
    //        rejectUnauthorized: false // Para evitar errores de certificado
    //    }
    //} : {}
//});

// ... (resto del c√≥digo de¬†sincronizaci√≥n)



async function connectDB() {
    try {
        await sequelize.authenticate();
        console.log('‚úÖ Conexi√≥n a la base de datos PostgreSQL exitosa.');
        
        // üõë CLAVE: COMENTA O ELIMINA LA L√çNEA DE SINCRONIZACI√ìN.
        // Esto permite que el servidor arranque si las tablas ya existen.
        // await sequelize.sync({}); 
        console.log('‚öô Modelos listos. NO se intent√≥ la sincronizaci√≥n autom√°tica.');

    } catch (error) {
        console.error('‚ùå Error al conectar o sincronizar la base de datos:', error.message);
        process.exit(1); 
    }
}

module.exports = { sequelize,¬†connectDB¬†};