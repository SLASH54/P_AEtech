// src/config/database.js
const { Sequelize, DataTypes } = require('sequelize');
require('dotenv').config();



// ... (aseg√∫rate de que esta l√≥gica est√© presente)
const isProduction = process.env.NODE_ENV === 'production' || process.env.DATABASE_URL;

const sequelize = isProduction
  ? new Sequelize(process.env.DATABASE_URL, {
      dialect: 'postgres',
      dialectOptions: {
        ssl: {
          require: true,
          rejectUnauthorized: false,
        },
      },
    })
  : new Sequelize(
      process.env.DB_NAME,
      process.env.DB_USER,
      process.env.DB_PASSWORD,
      {
        host: process.env.DB_HOST,
        dialect: 'postgres',
      }
    );




    // Configuraci√≥n espec√≠fica para producci√≥n (SSL) si usas una URL de Render/otro
    //dialectOptions: isProduction ? {
    //    ssl: {
    //       require: true, 
    //        rejectUnauthorized: false // Para evitar errores de certificado
    //    }
    //} : {}
//});

// ... (resto del c√≥digo de¬†sincronizaci√≥n)



async function connectDB() {
    try {
        await sequelize.authenticate();
        console.log('‚úÖ Conexi√≥n a la base de datos PostgreSQL exitosa.');
        
        // üõë CLAVE: COMENTA O ELIMINA LA L√çNEA DE SINCRONIZACI√ìN.
        // Esto permite que el servidor arranque si las tablas ya existen.
        // await sequelize.sync({}); 
        console.log('‚öô Modelos listos. NO se intent√≥ la sincronizaci√≥n autom√°tica.');

    } catch (error) {
        console.error('‚ùå Error al conectar o sincronizar la base de datos:', error.message);
        process.exit(1); 
    }
}

module.exports = { sequelize,¬†connectDB¬†};